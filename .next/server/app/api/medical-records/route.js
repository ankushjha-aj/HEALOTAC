"use strict";(()=>{var e={};e.id=55,e.ids=[55],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},6425:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>H,patchFetch:()=>A,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>N,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{GET:()=>p,POST:()=>m});var n=r(9303),o=r(8716),s=r(670),i=r(7070),d=r(5748),l=r(7327),u=r(7745),c=r(5456);async function p(e){let t=(0,c.EM)(["admin","user"])(e);if(t)return t;try{let{searchParams:t}=new URL(e.url),r=t.get("search"),a=d.db.select({id:l.HH.id,cadetId:l.HH.cadetId,name:l.VV.name,company:l.VV.company,battalion:l.VV.battalion,dateOfReporting:l.HH.dateOfReporting,medicalProblem:l.HH.medicalProblem,diagnosis:l.HH.diagnosis,status:l.HH.status,attendC:l.HH.attendC,trainingDaysMissed:l.HH.trainingDaysMissed,monitoringCase:l.HH.monitoringCase,contactNo:l.HH.contactNo,remarks:l.HH.remarks,createdAt:l.HH.createdAt,updatedAt:l.HH.updatedAt}).from(l.HH).innerJoin(l.VV,(0,u.eq)(l.HH.cadetId,l.VV.id)).orderBy(l.HH.createdAt);r&&console.log("\uD83D\uDD0D SEARCH QUERY:",r);let n=await a;return console.log("\uD83D\uDCCA FETCHED MEDICAL RECORDS:",n.length,"records"),i.NextResponse.json(n)}catch(e){return console.error("❌ Error fetching medical records:",e),i.NextResponse.json({error:"Failed to fetch medical records"},{status:500})}}async function m(e){let t=(0,c.EM)(["admin","user"])(e);if(t)return t;try{let{cadetId:t,dateOfReporting:r,medicalProblem:a,diagnosis:n,status:o,attendC:s,monitoringCase:c,contactNo:p,remarks:m}=await e.json();if(!t||!r||!a)return i.NextResponse.json({error:"Cadet ID, date of reporting, and medical problem are required"},{status:400});let g=await d.db.select().from(l.VV).where((0,u.eq)(l.VV.id,parseInt(t))).limit(1);if(0===g.length)return i.NextResponse.json({error:"Selected cadet does not exist"},{status:400});let f=s?parseInt(s):0,[h]=await d.db.insert(l.HH).values({cadetId:parseInt(t),dateOfReporting:new Date(r),medicalProblem:a,diagnosis:n,status:o||"Active",attendC:f,trainingDaysMissed:f,monitoringCase:!!(!0===c||"Yes"===c||"yes"===c||"true"===c),contactNo:p,remarks:m}).returning();return console.log("✅ CREATED MEDICAL RECORD:",h),i.NextResponse.json(h,{status:201})}catch(e){return console.error("❌ Error creating medical record:",e),i.NextResponse.json({error:"Failed to create medical record"},{status:500})}}let g=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/medical-records/route",pathname:"/api/medical-records",filename:"route",bundlePath:"app/api/medical-records/route"},resolvedPagePath:"/Users/ankushjha/Desktop/CURACADET/src/app/api/medical-records/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:N}=g,H="/api/medical-records/route";function A(){return(0,s.patchFetch)({serverHooks:N,staticGenerationAsyncStorage:h})}},5456:(e,t,r)=>{r.d(t,{EM:()=>s});var a=r(7070),n=r(1482),o=r.n(n);function s(e=[]){return function(t){let r=function(e){let t=e.headers.get("authorization");return t&&t.startsWith("Bearer ")?t.substring(7):null}(t);if(!r)return a.NextResponse.json({error:"Authentication required"},{status:401});let n=function(e){try{return o().verify(e,process.env.JWT_SECRET)}catch(e){return console.error("JWT verification failed:",e),null}}(r);return n?e.length>0&&!e.includes(n.role)?a.NextResponse.json({error:"Insufficient permissions"},{status:403}):(t.user=n,null):a.NextResponse.json({error:"Invalid or expired token"},{status:401})}}},5748:(e,t,r)=>{r.d(t,{db:()=>s});var a=r(2237),n=r(9802);let o=(0,a.qn)(process.env.DATABASE_URL),s=(0,n.tS)(o)},7327:(e,t,r)=>{r.d(t,{HH:()=>p,VV:()=>c,rC:()=>u});var a=r(3733),n=r(5961),o=r(1401),s=r(2140),i=r(1575),d=r(2941),l=r(8748);let u=(0,a.af)("users",{id:(0,n.eP)("id").primaryKey(),username:(0,o.L7)("username",{length:50}).unique().notNull(),password:(0,s.fL)("password").notNull(),email:(0,o.L7)("email",{length:255}),role:(0,o.L7)("role",{length:20}).default("user").notNull(),createdAt:(0,i.AB)("created_at").defaultNow().notNull(),updatedAt:(0,i.AB)("updated_at").defaultNow().notNull()}),c=(0,a.af)("cadets",{id:(0,n.eP)("id").primaryKey(),name:(0,o.L7)("name",{length:255}).notNull(),battalion:(0,o.L7)("battalion",{length:100}).notNull(),company:(0,o.L7)("company",{length:50}).notNull(),joinDate:(0,i.AB)("join_date").notNull(),status:(0,o.L7)("status",{length:20}).default("Active").notNull(),healthStatus:(0,o.L7)("health_status",{length:20}).default("Fit").notNull(),academyNumber:(0,d._L)("academy_number"),height:(0,d._L)("height"),weight:(0,d._L)("weight"),age:(0,d._L)("age"),course:(0,o.L7)("course",{length:100}),sex:(0,o.L7)("sex",{length:10}),createdAt:(0,i.AB)("created_at").defaultNow().notNull(),updatedAt:(0,i.AB)("updated_at").defaultNow().notNull()}),p=(0,a.af)("medical_records",{id:(0,n.eP)("id").primaryKey(),cadetId:(0,d._L)("cadet_id").references(()=>c.id).notNull(),dateOfReporting:(0,i.AB)("date_of_reporting").notNull(),medicalProblem:(0,s.fL)("medical_problem").notNull(),diagnosis:(0,s.fL)("diagnosis"),status:(0,o.L7)("status",{length:20}).default("Active").notNull(),attendC:(0,d._L)("attend_c").default(0).notNull(),trainingDaysMissed:(0,d._L)("training_days_missed").default(0),monitoringCase:(0,l.O7)("monitoring_case").default(!1).notNull(),contactNo:(0,o.L7)("contact_no",{length:20}),remarks:(0,s.fL)("remarks"),createdAt:(0,i.AB)("created_at").defaultNow().notNull(),updatedAt:(0,i.AB)("updated_at").defaultNow().notNull()})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948,351,482],()=>r(6425));module.exports=a})();