"use strict";(()=>{var e={};e.id=829,e.ids=[829],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},1450:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>N,patchFetch:()=>_,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var o={};r.r(o),r.d(o,{GET:()=>p});var a=r(9303),n=r(8716),l=r(670),i=r(7070),d=r(5748),s=r(7327),u=r(7745),c=r(5456);async function p(e,{params:t}){let r=(0,c.EM)(["admin","user"])(e);if(r)return r;try{let e=parseInt(t.id);if(console.log(`ðŸ” FETCHING MEDICAL HISTORY FOR CADET ID: ${e} (type: ${typeof e})`),isNaN(e))return i.NextResponse.json({error:"Invalid cadet ID"},{status:400});let r=await d.db.select().from(s.VV).where((0,u.eq)(s.VV.id,e)).limit(1);if(0===r.length)return i.NextResponse.json({error:"Cadet not found"},{status:404});let o={...r[0],joinDate:r[0].joinDate.toISOString(),createdAt:r[0].createdAt.toISOString()};console.log("âœ… CADET FOUND:",o.name);let a=await d.db.select().from(s.HH);console.log(`ðŸ“Š TOTAL MEDICAL RECORDS IN DB: ${a.length}`),console.log("\uD83D\uDCCB ALL RECORDS:",a.map(e=>({id:e.id,cadetId:e.cadetId,medicalProblem:e.medicalProblem}))),console.log(`ðŸ” SEARCHING FOR RECORDS WITH cadetId = ${e} (type: ${typeof e})`);let n=await d.db.select().from(s.HH).where((0,u.eq)(s.HH.cadetId,e));return console.log(`ðŸ“Š QUERY RESULT: ${n.length} records`),console.log(`ðŸ“Š FINAL RESULT: ${n.length} MEDICAL RECORDS FOR CADET ${e}`),console.log("\uD83D\uDCCB RECORDS DETAILS:",n.map(e=>({id:e.id,cadetId:e.cadetId,medicalProblem:e.medicalProblem}))),i.NextResponse.json({cadet:o,records:n.map(e=>({...e,dateOfReporting:e.dateOfReporting.toISOString(),createdAt:e.createdAt.toISOString()}))})}catch(e){return console.error("âŒ Error fetching medical history:",e),i.NextResponse.json({error:"Failed to fetch medical history"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/medical-history/[id]/route",pathname:"/api/medical-history/[id]",filename:"route",bundlePath:"app/api/medical-history/[id]/route"},resolvedPagePath:"/Users/ankushjha/Desktop/CURACADET/src/app/api/medical-history/[id]/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:h}=m,N="/api/medical-history/[id]/route";function _(){return(0,l.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},5456:(e,t,r)=>{r.d(t,{EM:()=>i});var o=r(7070),a=r(1482),n=r.n(a);if(!process.env.JWT_SECRET)throw Error("JWT_SECRET environment variable is not defined");let l={algorithm:"HS256"};function i(e=[]){return function(t){let r=function(e){let t=e.headers.get("authorization");return t&&t.startsWith("Bearer ")?t.substring(7):null}(t);if(!r)return o.NextResponse.json({error:"Authentication required"},{status:401});let a=function(e){for(let t of[process.env.JWT_SECRET,process.env.PREV_JWT_SECRET||""].filter(Boolean))try{return n().verify(e,t,{algorithms:[l.algorithm]})}catch(e){}return console.error("JWT verification failed with all secrets"),null}(r);return a?e.length>0&&!e.includes(a.role)?o.NextResponse.json({error:"Insufficient permissions"},{status:403}):(t.user=a,null):o.NextResponse.json({error:"Invalid or expired token"},{status:401})}}},5748:(e,t,r)=>{r.d(t,{db:()=>l});var o=r(2237),a=r(9802);let n=(0,o.qn)(process.env.DATABASE_URL),l=(0,a.tS)(n)},7327:(e,t,r)=>{r.d(t,{HH:()=>p,VV:()=>c,rC:()=>u});var o=r(3733),a=r(5961),n=r(1401),l=r(2140),i=r(1575),d=r(2941),s=r(8748);let u=(0,o.af)("users",{id:(0,a.eP)("id").primaryKey(),username:(0,n.L7)("username",{length:50}).unique().notNull(),password:(0,l.fL)("password").notNull(),email:(0,n.L7)("email",{length:255}),role:(0,n.L7)("role",{length:20}).default("user").notNull(),createdAt:(0,i.AB)("created_at").defaultNow().notNull(),updatedAt:(0,i.AB)("updated_at").defaultNow().notNull()}),c=(0,o.af)("cadets",{id:(0,a.eP)("id").primaryKey(),name:(0,n.L7)("name",{length:255}).notNull(),battalion:(0,n.L7)("battalion",{length:100}).notNull(),company:(0,n.L7)("company",{length:50}).notNull(),joinDate:(0,i.AB)("join_date").notNull(),academyNumber:(0,d._L)("academy_number"),height:(0,d._L)("height"),weight:(0,d._L)("weight"),age:(0,d._L)("age"),course:(0,n.L7)("course",{length:100}),sex:(0,n.L7)("sex",{length:10}),relegated:(0,n.L7)("relegated",{length:1}).default("N").notNull(),createdAt:(0,i.AB)("created_at").defaultNow().notNull(),updatedAt:(0,i.AB)("updated_at").defaultNow().notNull()}),p=(0,o.af)("medical_records",{id:(0,a.eP)("id").primaryKey(),cadetId:(0,d._L)("cadet_id").references(()=>c.id).notNull(),dateOfReporting:(0,i.AB)("date_of_reporting").notNull(),medicalProblem:(0,l.fL)("medical_problem").notNull(),diagnosis:(0,l.fL)("diagnosis"),medicalStatus:(0,n.L7)("medical_status",{length:20}).default("Active").notNull(),attendC:(0,d._L)("attend_c").default(0).notNull(),miDetained:(0,d._L)("mi_detained").default(0).notNull(),exPpg:(0,d._L)("ex_ppg").default(0).notNull(),attendB:(0,d._L)("attend_b").default(0).notNull(),physiotherapy:(0,d._L)("physiotherapy").default(0).notNull(),totalTrainingDaysMissed:(0,d._L)("total_training_days_missed").default(0).notNull(),monitoringCase:(0,s.O7)("monitoring_case").default(!1).notNull(),contactNo:(0,n.L7)("contact_no",{length:20}),remarks:(0,l.fL)("remarks"),createdAt:(0,i.AB)("created_at").defaultNow().notNull(),updatedAt:(0,i.AB)("updated_at").defaultNow().notNull()})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[276,351,482],()=>r(1450));module.exports=o})();