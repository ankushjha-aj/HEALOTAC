"use strict";(()=>{var e={};e.id=315,e.ids=[315],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},5308:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>w,requestAsyncStorage:()=>N,routeModule:()=>m,serverHooks:()=>_,staticGenerationAsyncStorage:()=>D});var a={};r.r(a),r.d(a,{DELETE:()=>h,GET:()=>p,PATCH:()=>g,PUT:()=>f});var n=r(9303),o=r(8716),s=r(670),d=r(7070),i=r(5748),u=r(7327),l=r(7745),c=r(5456);async function p(e,{params:t}){let r=(0,c.EM)(["admin","user"])(e);if(r)return r;try{let e=parseInt(t.id),[r]=await i.db.select().from(u.VV).where((0,l.eq)(u.VV.id,e)).limit(1);if(!r)return d.NextResponse.json({error:"Cadet not found"},{status:404});return d.NextResponse.json(r)}catch(e){return console.error("❌ Error fetching cadet:",e),d.NextResponse.json({error:"Failed to fetch cadet"},{status:500})}}async function f(e,{params:t}){try{let{name:r,battalion:a,company:n,joinDate:o,academyNumber:s,height:c,weight:p,age:f,course:g,sex:h}=await e.json(),[m]=await i.db.update(u.VV).set({name:r,battalion:a,company:n,joinDate:o?new Date(o):void 0,academyNumber:s?parseInt(s):void 0,height:"number"==typeof c?c:c?parseInt(c):void 0,weight:"number"==typeof p?p:p?parseInt(p):void 0,age:"number"==typeof f?f:f?parseInt(f):void 0,course:g,sex:h,updatedAt:new Date}).where((0,l.eq)(u.VV.id,parseInt(t.id))).returning();if(!m)return d.NextResponse.json({error:"Cadet not found"},{status:404});return console.log("\uD83D\uDD04 UPDATED CADET:",m),d.NextResponse.json(m)}catch(e){return console.error("❌ Error updating cadet:",e),d.NextResponse.json({error:"Failed to update cadet"},{status:500})}}async function g(e,{params:t}){try{let r=await e.json(),a={};if("weight"in r&&(a.weight="number"==typeof r.weight?r.weight:r.weight?parseInt(r.weight):void 0),0===Object.keys(a).length)return d.NextResponse.json({error:"No valid fields to update"},{status:400});a.updatedAt=new Date;let[n]=await i.db.update(u.VV).set(a).where((0,l.eq)(u.VV.id,parseInt(t.id))).returning();if(!n)return d.NextResponse.json({error:"Cadet not found"},{status:404});return console.log("\uD83D\uDD04 PARTIALLY UPDATED CADET:",n),d.NextResponse.json(n)}catch(e){return console.error("❌ Error partially updating cadet:",e),d.NextResponse.json({error:"Failed to update cadet"},{status:500})}}async function h(e,{params:t}){try{let e=parseInt(t.id);await i.db.delete(u.HH).where((0,l.eq)(u.HH.cadetId,e)),console.log("\uD83D\uDDD1️ DELETED MEDICAL RECORDS for cadet ID:",e);let[r]=await i.db.delete(u.VV).where((0,l.eq)(u.VV.id,e)).returning();if(!r)return d.NextResponse.json({error:"Cadet not found"},{status:404});return console.log("\uD83D\uDDD1️ DELETED CADET:",r),d.NextResponse.json({message:"Cadet and associated medical records deleted successfully",deletedCadet:r})}catch(e){return console.error("❌ Error deleting cadet:",e),d.NextResponse.json({error:"Failed to delete cadet"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/cadets/[id]/route",pathname:"/api/cadets/[id]",filename:"route",bundlePath:"app/api/cadets/[id]/route"},resolvedPagePath:"/Users/ankushjha/Desktop/CURACADET/src/app/api/cadets/[id]/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:N,staticGenerationAsyncStorage:D,serverHooks:_}=m,y="/api/cadets/[id]/route";function w(){return(0,s.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:D})}},5456:(e,t,r)=>{r.d(t,{EM:()=>d});var a=r(7070),n=r(1482),o=r.n(n);if(!process.env.JWT_SECRET)throw Error("JWT_SECRET environment variable is not defined");let s={algorithm:"HS256"};function d(e=[]){return function(t){let r=function(e){let t=e.headers.get("authorization");return t&&t.startsWith("Bearer ")?t.substring(7):null}(t);if(!r)return a.NextResponse.json({error:"Authentication required"},{status:401});let n=function(e){for(let t of[process.env.JWT_SECRET,process.env.PREV_JWT_SECRET||""].filter(Boolean))try{return o().verify(e,t,{algorithms:[s.algorithm]})}catch(e){}return console.error("JWT verification failed with all secrets"),null}(r);return n?e.length>0&&!e.includes(n.role)?a.NextResponse.json({error:"Insufficient permissions"},{status:403}):(t.user=n,null):a.NextResponse.json({error:"Invalid or expired token"},{status:401})}}},5748:(e,t,r)=>{r.d(t,{db:()=>s});var a=r(2237),n=r(9802);let o=(0,a.qn)(process.env.DATABASE_URL),s=(0,n.tS)(o)},7327:(e,t,r)=>{r.d(t,{HH:()=>p,VV:()=>c,rC:()=>l});var a=r(3733),n=r(5961),o=r(1401),s=r(2140),d=r(1575),i=r(2941),u=r(8748);let l=(0,a.af)("users",{id:(0,n.eP)("id").primaryKey(),username:(0,o.L7)("username",{length:50}).unique().notNull(),password:(0,s.fL)("password").notNull(),email:(0,o.L7)("email",{length:255}),role:(0,o.L7)("role",{length:20}).default("user").notNull(),createdAt:(0,d.AB)("created_at").defaultNow().notNull(),updatedAt:(0,d.AB)("updated_at").defaultNow().notNull()}),c=(0,a.af)("cadets",{id:(0,n.eP)("id").primaryKey(),name:(0,o.L7)("name",{length:255}).notNull(),battalion:(0,o.L7)("battalion",{length:100}).notNull(),company:(0,o.L7)("company",{length:50}).notNull(),joinDate:(0,d.AB)("join_date").notNull(),academyNumber:(0,i._L)("academy_number"),height:(0,i._L)("height"),weight:(0,i._L)("weight"),age:(0,i._L)("age"),course:(0,o.L7)("course",{length:100}),sex:(0,o.L7)("sex",{length:10}),relegated:(0,o.L7)("relegated",{length:1}).default("N").notNull(),createdAt:(0,d.AB)("created_at").defaultNow().notNull(),updatedAt:(0,d.AB)("updated_at").defaultNow().notNull()}),p=(0,a.af)("medical_records",{id:(0,n.eP)("id").primaryKey(),cadetId:(0,i._L)("cadet_id").references(()=>c.id).notNull(),dateOfReporting:(0,d.AB)("date_of_reporting").notNull(),medicalProblem:(0,s.fL)("medical_problem").notNull(),diagnosis:(0,s.fL)("diagnosis"),medicalStatus:(0,o.L7)("medical_status",{length:20}).default("Active").notNull(),attendC:(0,i._L)("attend_c").default(0).notNull(),miDetained:(0,i._L)("mi_detained").default(0).notNull(),exPpg:(0,i._L)("ex_ppg").default(0).notNull(),attendB:(0,i._L)("attend_b").default(0).notNull(),physiotherapy:(0,i._L)("physiotherapy").default(0).notNull(),totalTrainingDaysMissed:(0,i._L)("total_training_days_missed").default(0).notNull(),monitoringCase:(0,u.O7)("monitoring_case").default(!1).notNull(),contactNo:(0,o.L7)("contact_no",{length:20}),remarks:(0,s.fL)("remarks"),createdAt:(0,d.AB)("created_at").defaultNow().notNull(),updatedAt:(0,d.AB)("updated_at").defaultNow().notNull()})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,351,482],()=>r(5308));module.exports=a})();