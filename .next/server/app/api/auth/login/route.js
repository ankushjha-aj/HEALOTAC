"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},8739:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>L,patchFetch:()=>A,requestAsyncStorage:()=>_,routeModule:()=>h,serverHooks:()=>f,staticGenerationAsyncStorage:()=>N});var r={};a.r(r),a.d(r,{POST:()=>g});var o=a(9303),n=a(8716),l=a(670),s=a(7070),u=a(8691),i=a(1482),d=a.n(i),p=a(5748),c=a(7327),m=a(7745);async function g(e){try{let{username:t,password:a}=await e.json();if(console.log("Login attempt:",{username:t,hasPassword:!!a}),console.log("JWT_SECRET available:",!!process.env.JWT_SECRET),!t||!a)return s.NextResponse.json({error:"Username and password are required"},{status:400});let[r]=await p.db.select().from(c.rC).where((0,m.eq)(c.rC.username,t)).limit(1);if(!r||!await u.ZP.compare(a,r.password))return s.NextResponse.json({error:"Invalid credentials"},{status:401});let o=d().sign({userId:r.id,username:r.username,role:r.role},process.env.JWT_SECRET,{expiresIn:"24h"});return s.NextResponse.json({message:"Login successful",token:o,user:{id:r.id,username:r.username,role:r.role}})}catch(e){return console.error("Login error:",e),s.NextResponse.json({error:"Internal server error"},{status:500})}}let h=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/Users/ankushjha/Desktop/CURACADET/src/app/api/auth/login/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:_,staticGenerationAsyncStorage:N,serverHooks:f}=h,L="/api/auth/login/route";function A(){return(0,l.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:N})}},5748:(e,t,a)=>{a.d(t,{db:()=>l});var r=a(2237),o=a(9802);let n=(0,r.qn)(process.env.DATABASE_URL),l=(0,o.tS)(n)},7327:(e,t,a)=>{a.d(t,{HH:()=>c,VV:()=>p,rC:()=>d});var r=a(3733),o=a(5961),n=a(1401),l=a(2140),s=a(1575),u=a(2941),i=a(8748);let d=(0,r.af)("users",{id:(0,o.eP)("id").primaryKey(),username:(0,n.L7)("username",{length:50}).unique().notNull(),password:(0,l.fL)("password").notNull(),email:(0,n.L7)("email",{length:255}),role:(0,n.L7)("role",{length:20}).default("user").notNull(),createdAt:(0,s.AB)("created_at").defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at").defaultNow().notNull()}),p=(0,r.af)("cadets",{id:(0,o.eP)("id").primaryKey(),name:(0,n.L7)("name",{length:255}).notNull(),battalion:(0,n.L7)("battalion",{length:100}).notNull(),company:(0,n.L7)("company",{length:50}).notNull(),joinDate:(0,s.AB)("join_date").notNull(),academyNumber:(0,u._L)("academy_number"),height:(0,u._L)("height"),weight:(0,u._L)("weight"),age:(0,u._L)("age"),course:(0,n.L7)("course",{length:100}),sex:(0,n.L7)("sex",{length:10}),relegated:(0,n.L7)("relegated",{length:1}).default("N").notNull(),createdAt:(0,s.AB)("created_at").defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at").defaultNow().notNull()}),c=(0,r.af)("medical_records",{id:(0,o.eP)("id").primaryKey(),cadetId:(0,u._L)("cadet_id").references(()=>p.id).notNull(),dateOfReporting:(0,s.AB)("date_of_reporting").notNull(),medicalProblem:(0,l.fL)("medical_problem").notNull(),diagnosis:(0,l.fL)("diagnosis"),medicalStatus:(0,n.L7)("medical_status",{length:20}).default("Active").notNull(),attendC:(0,u._L)("attend_c").default(0).notNull(),miDetained:(0,u._L)("mi_detained").default(0).notNull(),exPpg:(0,u._L)("ex_ppg").default(0).notNull(),attendB:(0,u._L)("attend_b").default(0).notNull(),physiotherapy:(0,u._L)("physiotherapy").default(0).notNull(),totalTrainingDaysMissed:(0,u._L)("total_training_days_missed").default(0).notNull(),monitoringCase:(0,i.O7)("monitoring_case").default(!1).notNull(),contactNo:(0,n.L7)("contact_no",{length:20}),remarks:(0,l.fL)("remarks"),createdAt:(0,s.AB)("created_at").defaultNow().notNull(),updatedAt:(0,s.AB)("updated_at").defaultNow().notNull()})}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[276,351,482,691],()=>a(8739));module.exports=r})();